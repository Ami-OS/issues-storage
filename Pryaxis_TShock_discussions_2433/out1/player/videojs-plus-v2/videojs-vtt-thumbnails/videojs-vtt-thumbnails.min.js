/**
 * videojs-vtt-thumbnails
 * @version 0.0.13
 * @copyright 2021 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsVttThumbnails=t(e.videojs)}(this,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e),n={},o={},s=r.default.registerPlugin||r.default.plugin,e=function(s){var i=this;this.ready(function(){var e,t;e=i,t=r.default.mergeOptions(n,s),e.addClass("vjs-vtt-thumbnails"),e.vttThumbnails=new a(e,t)})},a=function(){function e(e,t){return this.player=e,this.options=t,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}var t=e.prototype;return t.src=function(e){this.resetPlugin(),this.options.src=e,this.initializeThumbnails()},t.detach=function(){this.resetPlugin()},t.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},t.listenForDurationChange=function(){this.player.on("durationchange",function(){})},t.initializeThumbnails=function(){var e,t=this;this.options.src&&(e=this.getBaseUrl(),e=this.getFullyQualifiedUrl(this.options.src,e),this.getVttFile(e).then(function(e){t.vttData=t.processVtt(e),t.setupThumbnailElement()}))},t.getBaseUrl=function(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()},t.getVttFile=function(i){var r=this;return new Promise(function(e,t){var s=new XMLHttpRequest;s.data={resolve:e},s.addEventListener("load",r.vttFileLoaded),s.open("GET",i),s.overrideMimeType("text/plain; charset=utf-8"),s.send()})},t.vttFileLoaded=function(){this.data.resolve(this.responseText),"function"==typeof document.loadInit&&document.loadInit()},t.setupThumbnailElement=function(e){var t=this,s=this.player.$(".vjs-mouse-display"),i=document.createElement("div");i.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(i),this.thumbnailHolder=i,s&&s.classList.add("vjs-mouse-thumbnail"),this.registeredEvents.progressBarMouseEnter=function(){return t.onBarMouseenter()},this.registeredEvents.progressBarMouseLeave=function(){return t.onBarMouseleave()},this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)},t.onBarMouseenter=function(){var t=this;this.mouseMoveCallback=function(e){t.onBarMousemove(e)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()},t.onBarMouseleave=function(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()},t.getXCoord=function(e,t){var s=e.getBoundingClientRect(),e=document.documentElement;return t-(s.left+(window.pageXOffset||e.scrollLeft||0))},t.onBarMousemove=function(e){this.updateThumbnailStyle(r.default.dom.getPointerPosition(this.progressBar,e).x,this.progressBar.offsetWidth)},t.getStyleForTime=function(e){for(var t=0;t<this.vttData.length;++t){var s,i=this.vttData[t];if(e>=i.start&&e<i.end)return i.css.url&&!o[i.css.url]&&((s=new Image).src=i.css.url,o[i.css.url]=s),i.css}},t.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},t.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},t.updateThumbnailStyle=function(e,t){var s=this.player.duration(),i=this.getStyleForTime(e*s);if(!i)return this.hideThumbnailHolder();var r=e*t,n=parseInt(i.width,10),o=n>>1,s=t-(r+o),e=r-o;if(t<n?this.thumbnailHolder.style.left=(n-t)/2*-1+"px":0<e&&0<s?this.thumbnailHolder.style.left=r-o+"px":e<=0?this.thumbnailHolder.style.left="0px":s<=0&&(this.thumbnailHolder.style.left=t-n+"px"),!this.lastStyle||this.lastStyle!==i)for(var a in this.lastStyle=i)i.hasOwnProperty(a)&&(this.thumbnailHolder.style[a]=i[a])},t.processVtt=function(e){var i=this,r=[];return e.split(/[\r\n][\r\n]/i).forEach(function(e){var t,s;e.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)&&(e=(t=(s=e.split(/[\r\n]/i))[0].split(/ ?--> ?/i))[0],t=t[1],s=s[1],s=i.getVttCss(s),r.push({start:i.getSecondsFromTimestamp(e),end:i.getSecondsFromTimestamp(t),css:s}))}),r},t.getFullyQualifiedUrl=function(e,t){return 0<=e.indexOf("//")?e:0===t.indexOf("//")?[t.replace(/\/$/gi,""),this.trim(e,"/")].join("/"):0<t.indexOf("//")?[this.trim(t,"/"),this.trim(e,"/")].join("/"):e},t.getPropsFromDef=function(e){var t=e.split(/#xywh=/i),e=t[0],t=t[1].match(/[0-9]+/gi);return{x:t[0],y:t[1],w:t[2],h:t[3],image:e}},t.getVttCss=function(e){var t={},s=0<=this.options.src.indexOf("//")?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift();if(!(e=this.getFullyQualifiedUrl(e,s)).match(/#xywh=/i))return t.background='url("'+e+'")',t;e=this.getPropsFromDef(e);return t.background='url("'+e.image+'") no-repeat -'+e.x+"px -"+e.y+"px",t.width=e.w+"px",t.height=e.h+"px",t.url=e.image,t},t.deconstructTimestamp=function(e){var t=e.split("."),e=t[0].split(":");return{milliseconds:parseInt(t[1],10)||0,seconds:parseInt(e.pop(),10)||0,minutes:parseInt(e.pop(),10)||0,hours:parseInt(e.pop(),10)||0}},t.getSecondsFromTimestamp=function(e){e=this.deconstructTimestamp(e);return parseInt(3600*e.hours+60*e.minutes+e.seconds+e.milliseconds/1e3,10)},t.trim=function(e,t){var s=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),i=0,r=0;for(e+="",t&&(s=(t+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),i=e.length,r=0;r<i;r++)if(-1===s.indexOf(e.charAt(r))){e=e.substring(r);break}for(r=(i=e.length)-1;0<=r;r--)if(-1===s.indexOf(e.charAt(r))){e=e.substring(0,r+1);break}return-1===s.indexOf(e.charAt(0))?e:""},e}();return s("vttThumbnails",e),e.VERSION="0.0.13",e});